<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Azure Blob Storage Upload</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
</head>

<body>
  <section class="section">
    <div class="container">
      <h1 class="title">Uploading file to: </h1>
      <pre id="name">...</pre>
      <br>
      <label for="image">Choose a file to upload:</label>
      <input type="file" id="image" name="image" accept="*/*">
      <br>
      <label id="message"></label>
    </div>
  </section>
  <script src="main.js" type="text/javascript"></script>
  <script>
    (async function () {
      // const response = await fetch("/api/credentials");
      // const {url, sasKey} = await response.json();
      const regexp = /.z\d+.web./i;
      var containerName = "documents";

      var url = location.protocol.concat("//").concat(window.location.host).replace(regexp, '.blob.');
      var urlParams = new URLSearchParams(window.location.search);
      var sasKey = urlParams.toString();
      if (urlParams.has('container')) {
        containerName = urlParams.get('container');
      }

      document.querySelector('#name').textContent = `URL: ${url}` + "\n" + `SAS Key: ${sasKey}`;
      function uploadFile() {
        const file = document.getElementById('image').files[0];
        blobUpload(file, url, containerName, sasKey);
      };
      const fileInput = document.getElementById('image');
      fileInput.addEventListener("change", uploadFile);
    }())
  </script>
</body>

</html>